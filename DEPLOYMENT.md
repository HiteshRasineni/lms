# Deployment Guide

This guide covers deploying your LMS application using Render (backend + database) and Vercel (frontend).

## Architecture

- **Frontend**: Vercel (React + Vite)
- **Backend**: Render Web Service (Node.js + Express)
- **Database**: Render Private Service (MongoDB)

## Prerequisites

1. GitHub repository with your code
2. Render account (https://render.com)
3. Vercel account (https://vercel.com)
4. Cloudinary account for media storage
5. Google OAuth credentials (if using Google login)

---

## Part 1: Deploy Backend + Database on Render

### Option A: Using render.yaml (Recommended)

1. **Push your code to GitHub**

2. **Connect to Render**

   - Go to https://dashboard.render.com
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect `render.yaml`

3. **Configure Environment Variables**

   After deployment starts, go to each service and add:

   **Backend Service:**

   - `CLOUDINARY_CLOUD_NAME`: Your Cloudinary cloud name
   - `CLOUDINARY_API_KEY`: Your Cloudinary API key
   - `CLOUDINARY_API_SECRET`: Your Cloudinary API secret
   - `GOOGLE_CLIENT_ID`: Your Google OAuth client ID
   - `GOOGLE_CLIENT_SECRET`: Your Google OAuth client secret
   - `EMAIL_USER`: Your email for sending notifications
   - `EMAIL_PASS`: Your email app password
   - `FRONTEND_URL`: Your Vercel frontend URL (add after frontend deployment)

   Note: `JWT_SECRET` and `MONGODB_URI` are auto-generated by Render.

### Option B: Manual Setup

#### Step 1: Deploy MongoDB

1. Go to Render Dashboard → "New +" → "Private Service"
2. Select "Deploy an existing image from a registry"
3. Image URL: `mongo:7.0`
4. Name: `lms-mongodb`
5. Add environment variables:
   - `MONGO_INITDB_ROOT_USERNAME`: `admin`
   - `MONGO_INITDB_ROOT_PASSWORD`: (generate secure password)
   - `MONGO_INITDB_DATABASE`: `lms`
6. Add disk:
   - Mount path: `/data/db`
   - Size: 10GB
7. Click "Create Private Service"

#### Step 2: Deploy Backend

1. Go to Render Dashboard → "New +" → "Web Service"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `lms-backend`
   - **Environment**: Docker
   - **Dockerfile Path**: `./backend/Dockerfile`
   - **Docker Context**: `./backend`
4. Add environment variables:
   - `NODE_ENV`: `production`
   - `PORT`: `5000`
   - `MONGODB_URI`: `mongodb://admin:[PASSWORD]@lms-mongodb:27017/lms?authSource=admin`
     (Replace [PASSWORD] with your MongoDB password)
   - `JWT_SECRET`: (generate random string)
   - Add Cloudinary, Google OAuth, and email credentials
5. Click "Create Web Service"

---

## Part 2: Deploy Frontend on Vercel

### Using Vercel CLI (Recommended)

1. **Install Vercel CLI**

   ```bash
   npm install -g vercel
   ```

2. **Login to Vercel**

   ```bash
   vercel login
   ```

3. **Deploy from root directory**

   ```bash
   vercel
   ```

4. **Configure during deployment**

   - Project name: `lms-frontend`
   - Framework: Vite
   - Build command: `cd frontend && npm install && npm run build`
   - Output directory: `frontend/dist`

5. **Set Environment Variable**

   ```bash
   vercel env add VITE_API_URL production
   ```

   Enter your Render backend URL: `https://lms-backend.onrender.com/api`

6. **Deploy to production**
   ```bash
   vercel --prod
   ```

### Using Vercel Dashboard

1. Go to https://vercel.com/new
2. Import your GitHub repository
3. Configure:
   - **Framework Preset**: Vite
   - **Root Directory**: Leave as `.` (root)
   - **Build Command**: `cd frontend && npm install && npm run build`
   - **Output Directory**: `frontend/dist`
4. Add environment variable:
   - `VITE_API_URL`: `https://lms-backend.onrender.com/api`
5. Click "Deploy"

---

## Part 3: Update Backend with Frontend URL

1. Go to your Render backend service
2. Add environment variable:
   - `FRONTEND_URL`: Your Vercel URL (e.g., `https://lms-frontend.vercel.app`)
3. This is needed for CORS configuration

---

## Environment Variables Summary

### Backend (Render)

```
NODE_ENV=production
PORT=5000
MONGODB_URI=mongodb://admin:[PASSWORD]@lms-mongodb:27017/lms?authSource=admin
JWT_SECRET=[generated]
CLOUDINARY_CLOUD_NAME=[your-value]
CLOUDINARY_API_KEY=[your-value]
CLOUDINARY_API_SECRET=[your-value]
GOOGLE_CLIENT_ID=[your-value]
GOOGLE_CLIENT_SECRET=[your-value]
EMAIL_USER=[your-value]
EMAIL_PASS=[your-value]
FRONTEND_URL=https://lms-frontend.vercel.app
```

### Frontend (Vercel)

```
VITE_API_URL=https://lms-backend.onrender.com/api
```

---

## Post-Deployment Checklist

- [ ] Backend is accessible at your Render URL
- [ ] Frontend is accessible at your Vercel URL
- [ ] Frontend can communicate with backend API
- [ ] MongoDB connection is working
- [ ] File uploads to Cloudinary work
- [ ] Google OAuth login works (if enabled)
- [ ] Email notifications work (if enabled)
- [ ] CORS is properly configured

---

## Troubleshooting

### Backend Issues

**MongoDB Connection Failed**

- Check `MONGODB_URI` format
- Ensure MongoDB service is running
- Verify credentials

**CORS Errors**

- Add `FRONTEND_URL` to backend environment variables
- Check CORS configuration in `backend/server.js`

### Frontend Issues

**API Calls Failing**

- Verify `VITE_API_URL` is set correctly
- Check backend URL is accessible
- Look at browser console for errors

**Build Failures**

- Check build command is correct
- Verify all dependencies are in `package.json`
- Check Node version compatibility

---

## Monitoring & Logs

### Render

- View logs: Dashboard → Service → Logs tab
- Monitor metrics: Dashboard → Service → Metrics tab

### Vercel

- View deployments: Dashboard → Project → Deployments
- Check logs: Click on deployment → View Function Logs

---

## Updating Your Application

### Backend

- Push changes to GitHub
- Render auto-deploys from main branch

### Frontend

- Push changes to GitHub
- Vercel auto-deploys from main branch

Or use CLI:

```bash
vercel --prod
```

---

## Cost Considerations

### Render Free Tier

- Web services spin down after 15 minutes of inactivity
- 750 hours/month free
- Private services available on paid plans

### Vercel Free Tier

- 100GB bandwidth/month
- Unlimited deployments
- Automatic HTTPS

---

## Alternative: Deploy Everything on Render

If you prefer to host everything on Render:

1. Deploy backend as Web Service (as above)
2. Deploy MongoDB as Private Service (as above)
3. Deploy frontend as Static Site:
   - Build command: `cd frontend && npm install && npm run build`
   - Publish directory: `frontend/dist`

This keeps everything in one place but may be more expensive than using Vercel's free tier for the frontend.
